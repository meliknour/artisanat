<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>قائمة المنتجات</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; padding:20px; }
    h1 { text-align:center; color:#3a3b57; }
    table { width:100%; border-collapse:collapse; margin-top:20px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    th, td { padding:12px; border-bottom:1px solid #ddd; text-align:center; }
    th { background:#3a3b57; color:#fff; }
    tr:hover { background:#f1f1f1; }
    .qr { width:80px; height:80px; }
  </style>
</head>
<body>

  <h1>📦 قائمة المنتجات</h1>

  <table>
    <thead>
      <tr>
        <th>اسم المنتج</th>
        <th>رمز QR</th>
        <th>رابط العرض</th>
      </tr>
    </thead>
    <tbody id="productList">
      <tr><td colspan="3">⏳ جاري تحميل البيانات...</td></tr>
    </tbody>
  </table>

  <script type="module">
    // ✅ إعداد Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDq-S2CBiNmccar_neNVg5T95XbwV6t0cY",
      authDomain: "artisanat-161f3.firebaseapp.com",
      projectId: "artisanat-161f3",
      storageBucket: "artisanat-161f3.appspot.com",
      messagingSenderId: "203989144161",
      appId: "1:203989144161:web:88273bf2b917ddc0a65020",
      measurementId: "G-9350J62Z5H"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ✅ تحميل المنتجات من Firestore
    async function loadProducts() {
      const list = document.getElementById("productList");
      list.innerHTML = "";
      try {
        const snapshot = await db.collection("products").get();
        if (snapshot.empty) {
          list.innerHTML = "<tr><td colspan='3'>🚫 لا توجد منتجات</td></tr>";
          return;
        }
        snapshot.forEach(doc => {
          const data = doc.data();
          const id = doc.id;
          const name = data.name || "بدون اسم";

          // رابط العرض
          const viewUrl = `view.html?id=${id}`;
          const fullUrl = `https://meliknour.github.io/artisanat/${viewUrl}`;

          // توليد QR
          const canvas = document.createElement("canvas");
          new QRious({
            element: canvas,
            value: fullUrl,
            size: 80
          });

          const row = `
            <tr>
              <td>${name}</td>
              <td><img src="${canvas.toDataURL()}" class="qr"></td>
              <td><a href="${viewUrl}" target="_blank">🔗 فتح المنتج</a></td>
            </tr>
          `;
          list.innerHTML += row;
        });
      } catch (e) {
        console.error(e);
        list.innerHTML = "<tr><td colspan='3'>⚠️ خطأ في تحميل البيانات</td></tr>";
      }
    }

    loadProducts();
  </script>

</body>
</html>
