<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>عرض بطاقة المنتج</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:20px; }
    .container { max-width:900px; margin:auto; background:#fff; padding:25px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
    h1 { text-align:center; color:#0056b3; border-bottom:3px solid #0056b3; padding-bottom:10px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ddd; padding:10px; text-align:right; }
    th { background:#e9ecef; width:35%; }
    #productImage { max-width:100%; max-height:250px; border:1px solid #ddd; border-radius:4px; margin:20px auto; display:block; }
  </style>
</head>
<body>

<div class="container">
  <h1>بطاقة تقنية للمنتوج</h1>
  <img id="productImage" alt="صورة المنتج">
  <table id="productTable"></table>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// إعداد Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDq-S2CBiNmccar_neNVg5T95XbwV6t0cY",
  authDomain: "artisanat-161f3.firebaseapp.com",
  projectId: "artisanat-161f3",
  storageBucket: "artisanat-161f3.firebasestorage.app",
  messagingSenderId: "203989144161",
  appId: "1:203989144161:web:88273bf2b917ddc0a65020",
  measurementId: "G-9350J62Z5H"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// استخراج ID من الرابط
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (id) {
  loadProduct(id);
} else {
  document.querySelector(".container").innerHTML = "<h2 style='color:red;text-align:center'>⚠️ لا يوجد معرف منتج</h2>";
}

async function loadProduct(id) {
  try {
    const docRef = doc(db, "products", id);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const data = docSnap.data();

      // صورة
      if (data.imageUrl) {
        document.getElementById("productImage").src = data.imageUrl;
      } else {
        document.getElementById("productImage").style.display = "none";
      }

      // الجدول
      let html = "";
      for (const key in data) {
        if (key !== "imageUrl" && key !== "createdAt") {
          html += `<tr><th>${key}</th><td>${data[key]}</td></tr>`;
        }
      }
      document.getElementById("productTable").innerHTML = html;

    } else {
      document.querySelector(".container").innerHTML = "<h2 style='color:red;text-align:center'>⚠️ المنتج غير موجود</h2>";
    }
  } catch (e) {
    console.error("❌ خطأ أثناء جلب المنتج:", e);
    document.querySelector(".container").innerHTML = "<h2 style='color:red;text-align:center'>❌ خطأ في تحميل البيانات</h2>";
  }
}
</script>

</body>
</html>
