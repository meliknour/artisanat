<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø·Ø§Ù‚Ø© ØªÙ‚Ù†ÙŠØ© Ù„Ù„Ù…Ù†ØªÙˆØ¬</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:20px; }
    .container { max-width:900px; margin:auto; background:#fff; padding:25px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
    h1 { text-align:center; color:#0056b3; border-bottom:3px solid #0056b3; padding-bottom:10px; }
    label { font-weight:bold; margin-top:12px; display:block; }
    input[type="text"], textarea { width:100%; padding:8px; margin-top:5px; border:1px solid #bbb; border-radius:5px; }
    textarea { resize:vertical; min-height:70px; }
    .options { margin:8px 0; }
    .options label { font-weight:normal; margin-left:15px; }
    button { margin-top:20px; padding:12px; border:none; border-radius:6px; cursor:pointer; }
    #showButton { background:#28a745; color:#fff; display:block; width:50%; margin:20px auto 0; }
    #backButton { background:#6c757d; color:#fff; display:block; width:30%; margin:20px auto 0; }
    #pdfButton { background:#007bff; color:#fff; display:block; width:30%; margin:20px auto 0; }
    #imageContainer { text-align:center; margin-bottom:20px; border:2px dashed #ccc; padding:15px; border-radius:8px; }
    #previewImage { max-width:100%; max-height:200px; margin-top:10px; display:none; border:1px solid #ddd; border-radius:4px; cursor:pointer; }
    #displayOutput { display:none; }
    #displayOutput table { width:100%; border-collapse:collapse; margin-top:20px; }
    #displayOutput th, #displayOutput td { border:1px solid #ddd; padding:10px; text-align:right; }
    #displayOutput th { background:#e9ecef; width:35%; }
    #outputImage { max-width:100%; max-height:250px; border:1px solid #ddd; border-radius:4px; margin-bottom:15px; }
    #qrcode { text-align:center; margin:20px; }
  </style>
</head>
<body>

<div class="container" id="inputForm">
  <h1>Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø·Ø§Ù‚Ø© ØªÙ‚Ù†ÙŠØ© Ù„Ù„Ù…Ù†ØªÙˆØ¬</h1>

  <!-- Ø±ÙØ¹ ØµÙˆØ±Ø© -->
  <div id="imageContainer">
    <h2>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (URL)</h2>
    <input type="text" id="imageUrl" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§">
  </div>

  <!-- Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬ -->
  <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬:</label>
  <div class="options">
    <label><input type="checkbox" name="productType" value="ÙŠØ¯ÙˆÙŠ"> ÙŠØ¯ÙˆÙŠ</label>
    <label><input type="checkbox" name="productType" value="ÙŠØ¯ÙˆÙŠ Ø¨Ø§Ù„Ø¢Ù„Ø©"> ÙŠØ¯ÙˆÙŠ Ø¨Ø§Ù„Ø¢Ù„Ø©</label>
    <label><input type="checkbox" name="productType" value="Ø¢Ù„ÙŠ"> Ø¢Ù„ÙŠ</label>
  </div>

  <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ -->
  <label>Ø¥Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
  <input type="text" id="productName" value="Ù„ÙˆØ­Ø© ÙÙ†ÙŠØ©">

  <label>Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„Ø§Øª:</label>
  <textarea id="uses">Ø§Ù„ØªØ²ÙŠÙŠÙ† - Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</textarea>

  <label>Ø§Ù„Ø­Ø¬Ù…:</label>
  <input type="text" id="size" value="80 Ø³Ù… Ã— 60 Ø³Ù…">

  <label>Ø§Ù„ÙˆØ²Ù†:</label>
  <input type="text" id="weight" value="Ù…ØªÙˆØ³Ø·">

  <label>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©:</label>
  <textarea id="rawMaterials">Ù‚Ù…Ø§Ø´ØŒ Ø®Ø´Ø¨ Ø£Ø¨ÙŠØ¶ØŒ Ø£Ù„ÙˆØ§Ù† Ø²ÙŠØªÙŠØ©</textarea>

  <label>Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²:</label>
  <textarea id="stages">Ø¨Ø­Ø« - ØªØ®Ø·ÙŠØ· - ØªÙ„ÙˆÙŠÙ†</textarea>

  <label>Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø©:</label>
  <input type="text" id="tools" value="Ø±ÙŠØ´Ø©ØŒ Ø³ÙƒÙŠÙ† Ø±Ø³Ù…">

  <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø®Ù„ÙŠÙ†:</label>
  <input type="text" id="contributors" value="Ù†Ø¬Ø§Ø± ÙÙ†ÙŠ">

  <label>Ø§Ù„Ø£Ù„ÙˆØ§Ù†:</label>
  <textarea id="colors">Ø£Ø­Ù…Ø± - Ø£Ø²Ø±Ù‚ - Ø£ØµÙØ±</textarea>

  <label>Ù…Ø¯Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²:</label>
  <input type="text" id="duration" value="3 Ø£Ø´Ù‡Ø±">

  <label>Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø©:</label>
  <textarea id="techniques">Ø§Ù„Ø±Ø³Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¯ÙŠ ÙˆØ§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠ</textarea>

  <label>Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø¨ØªÙƒØ±Ø©:</label>
  <textarea id="innovations">Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ù Ø§Ù„Ù†Ø®ÙŠÙ„</textarea>

  <label>Ø§Ù„Ø³Ø¹Ø±:</label>
  <input type="text" id="price" value="30.000 Ø¯Ø¬">

  <button id="showButton" type="button">ğŸ’¾ Ø­ÙØ¸ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
</div>

<div class="container" id="displayOutput">
  <h1>Ø¨Ø·Ø§Ù‚Ø© ØªÙ‚Ù†ÙŠØ© Ù„Ù„Ù…Ù†ØªÙˆØ¬</h1>
  <div style="text-align:center;">
    <img id="outputImage">
  </div>
  <div id="qrcode"></div>
  <table id="outputTable"></table>
  <button id="pdfButton" type="button" onclick="downloadPDF()">ØªØ­Ù…ÙŠÙ„ PDF</button>
  <button id="backButton" type="button" onclick="editData()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
</div>

<!-- Ù…ÙƒØªØ¨Ø§Øª PDF + QR -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDq-S2CBiNmccar_neNVg5T95XbwV6t0cY",
  authDomain: "artisanat-161f3.firebaseapp.com",
  projectId: "artisanat-161f3",
  storageBucket: "artisanat-161f3.firebasestorage.app",
  messagingSenderId: "203989144161",
  appId: "1:203989144161:web:88273bf2b917ddc0a65020",
  measurementId: "G-9350J62Z5H"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.getElementById("showButton").addEventListener("click", async () => {
  const data = {
    name: document.getElementById("productName").value,
    type: Array.from(document.querySelectorAll('input[name="productType"]:checked')).map(c => c.value),
    uses: document.getElementById("uses").value,
    size: document.getElementById("size").value,
    weight: document.getElementById("weight").value,
    rawMaterials: document.getElementById("rawMaterials").value,
    stages: document.getElementById("stages").value,
    tools: document.getElementById("tools").value,
    contributors: document.getElementById("contributors").value,
    colors: document.getElementById("colors").value,
    duration: document.getElementById("duration").value,
    techniques: document.getElementById("techniques").value,
    innovations: document.getElementById("innovations").value,
    price: document.getElementById("price").value,
    imageUrl: document.getElementById("imageUrl").value,
    createdAt: new Date().toISOString()
  };

  try {
    const docRef = await addDoc(collection(db, "products"), data);

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    showCard(data, docRef.id);
  } catch (e) {
    console.error("âŒ Ø®Ø·Ø£:", e);
    alert("ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ (Ø´ÙˆÙ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„)");
  }
});

function showCard(data, id) {
  if (data.imageUrl) document.getElementById("outputImage").src = data.imageUrl;

  let tableHTML = "";
  for (const key in data) {
    if (key !== "imageUrl" && key !== "createdAt")
      tableHTML += `<tr><th>${key}</th><td>${data[key]}</td></tr>`;
  }
  document.getElementById("outputTable").innerHTML = tableHTML;

  // QR
  document.getElementById("qrcode").innerHTML = "";
  QRCode.toCanvas(
    document.createElement("canvas"),
    `https://meliknour.github.io/artisanat/index.html?id=${id}`,
    (err, canvas) => {
      if (!err) document.getElementById("qrcode").appendChild(canvas);
    }
  );

  document.getElementById("inputForm").style.display = "none";
  document.getElementById("displayOutput").style.display = "block";
}
</script>

<script>
function editData() {
  document.getElementById("displayOutput").style.display = "none";
  document.getElementById("inputForm").style.display = "block";
}

// ØªØ­Ù…ÙŠÙ„ PDF
async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "pt", "a4");
  const element = document.getElementById("displayOutput");

  const pdfButton = document.getElementById("pdfButton");
  const backButton = document.getElementById("backButton");
  pdfButton.style.display = "none";
  backButton.style.display = "none";

  const canvas = await html2canvas(element, { scale: 2 });
  const imgData = canvas.toDataURL("image/png");

  const imgProps = doc.getImageProperties(imgData);
  const pdfWidth = doc.internal.pageSize.getWidth();
  const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

  doc.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
  doc.save("Ø¨Ø·Ø§Ù‚Ø©-Ø§Ù„Ù…Ù†ØªÙˆØ¬.pdf");

  pdfButton.style.display = "block";
  backButton.style.display = "block";
}
</script>

</body>
</html>
