<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تعديل المنتج</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ✅ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDq-S2CBiNmccar_neNVg5T95XbwV6t0cY",
      authDomain: "artisanat-161f3.firebaseapp.com",
      projectId: "artisanat-161f3",
      storageBucket: "artisanat-161f3.appspot.com",
      messagingSenderId: "203989144161",
      appId: "1:203989144161:web:88273bf2b917ddc0a65020",
      measurementId: "G-9350J62Z5H"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ✅ الحصول على id من الرابط
    const params = new URLSearchParams(window.location.search);
    const productId = params.get("id");

    const form = document.getElementById("editForm");
    const message = document.getElementById("message");

    async function loadProduct() {
      if (!productId) {
        message.innerHTML = "❌ لم يتم تمرير معرف المنتج.";
        return;
      }

      try {
        const docRef = doc(db, "products", productId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();

          // ✅ تعبئة الحقول
          form.image.value = data.image || "";
          form.name.value = data.name || "";
          form.type.value = data.type || "";
          form.price.value = data.price || "";
          form.duration.value = data.duration || "";
          form.size.value = data.size || "";
          form.weight.value = data.weight || "";
          form.usage.value = data.usage || "";
          form.colors.value = data.colors || "";
          form.decoration.value = data.decoration || "";
          form.production.value = data.production || "";
          form.source.value = data.source || "";
          form.people.value = data.people || "";
          form.materials.value = data.materials || "";
          form.steps.value = data.steps || "";
          form.tools.value = data.tools || "";
          form.techniques.value = data.techniques || "";
          form.innovation.value = data.innovation || "";

        } else {
          message.innerHTML = "❌ المنتج غير موجود.";
        }
      } catch (error) {
        console.error("خطأ في جلب المنتج:", error);
        message.innerHTML = "⚠️ حدث خطأ أثناء تحميل البيانات.";
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      try {
        const docRef = doc(db, "products", productId);

        await updateDoc(docRef, {
          image: form.image.value,
          name: form.name.value,
          type: form.type.value,
          price: form.price.value,
          duration: form.duration.value,
          size: form.size.value,
          weight: form.weight.value,
          usage: form.usage.value,
          colors: form.colors.value,
          decoration: form.decoration.value,
          production: form.production.value,
          source: form.source.value,
          people: form.people.value,
          materials: form.materials.value,
          steps: form.steps.value,
          tools: form.tools.value,
          techniques: form.techniques.value,
          innovation: form.innovation.value,
        });

        message.innerHTML = "✅ تم تعديل المنتج بنجاح!";
        message.style.color = "green";
      } catch (error) {
        console.error("خطأ في التعديل:", error);
        message.innerHTML = "⚠️ حدث خطأ أثناء التعديل.";
        message.style.color = "red";
      }
    });

    loadProduct();
  </script>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
    .container { background:#fff; padding:20px; border-radius:15px; box-shadow:0 0 10px rgba(0,0,0,.1); max-width:700px; margin:auto; }
    h1 { text-align:center; color:#3a3b57; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input, textarea, select { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:8px; }
    button { margin-top:15px; padding:10px 15px; background:#3498db; color:white; border:none; border-radius:8px; cursor:pointer; }
    button:hover { background:#2980b9; }
    #message { text-align:center; margin-top:15px; font-weight:bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>✏️ تعديل المنتج</h1>
    <form id="editForm">
      <label>رابط صورة المنتج</label>
      <input type="text" name="image">

      <label>اسم المنتج</label>
      <input type="text" name="name">

      <label>نوع المنتج</label>
      <input type="text" name="type">

      <label>السعر</label>
      <input type="text" name="price">

      <label>مدة الإنجاز</label>
      <input type="text" name="duration">

      <label>الحجم</label>
      <input type="text" name="size">

      <label>الوزن</label>
      <input type="text" name="weight">

      <label>الاستعمال</label>
      <input type="text" name="usage">

      <label>الألوان</label>
      <input type="text" name="colors">

      <label>نوع التزيين والرموز</label>
      <input type="text" name="decoration">

      <label>الإنتاج</label>
      <input type="text" name="production">

      <label>مصدر المادة</label>
      <input type="text" name="source">

      <label>عدد المتدخلين</label>
      <input type="text" name="people">

      <label>المواد الأولية</label>
      <textarea name="materials"></textarea>

      <label>مراحل الإنجاز</label>
      <textarea name="steps"></textarea>

      <label>الأدوات المستعملة</label>
      <input type="text" name="tools">

      <label>التقنيات المستعملة</label>
      <input type="text" name="techniques">

      <label>التقنيات المبتكرة</label>
      <input type="text" name="innovation">

      <button type="submit">💾 حفظ التعديلات</button>
    </form>
    <div id="message"></div>
  </div>
</body>
</html>
