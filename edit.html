<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // âœ… Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDq-S2CBiNmccar_neNVg5T95XbwV6t0cY",
      authDomain: "artisanat-161f3.firebaseapp.com",
      projectId: "artisanat-161f3",
      storageBucket: "artisanat-161f3.appspot.com",
      messagingSenderId: "203989144161",
      appId: "1:203989144161:web:88273bf2b917ddc0a65020",
      measurementId: "G-9350J62Z5H"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // âœ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ id Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    const params = new URLSearchParams(window.location.search);
    const productId = params.get("id");

    const form = document.getElementById("editForm");
    const message = document.getElementById("message");

    async function loadProduct() {
      if (!productId) {
        message.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… ØªÙ…Ø±ÙŠØ± Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬.";
        return;
      }

      try {
        const docRef = doc(db, "products", productId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();

          // âœ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„
          form.image.value = data.image || "";
          form.name.value = data.name || "";
          form.type.value = data.type || "";
          form.price.value = data.price || "";
          form.duration.value = data.duration || "";
          form.size.value = data.size || "";
          form.weight.value = data.weight || "";
          form.usage.value = data.usage || "";
          form.colors.value = data.colors || "";
          form.decoration.value = data.decoration || "";
          form.production.value = data.production || "";
          form.source.value = data.source || "";
          form.people.value = data.people || "";
          form.materials.value = data.materials || "";
          form.steps.value = data.steps || "";
          form.tools.value = data.tools || "";
          form.techniques.value = data.techniques || "";
          form.innovation.value = data.innovation || "";

        } else {
          message.innerHTML = "âŒ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.";
        }
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬:", error);
        message.innerHTML = "âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      try {
        const docRef = doc(db, "products", productId);

        await updateDoc(docRef, {
          image: form.image.value,
          name: form.name.value,
          type: form.type.value,
          price: form.price.value,
          duration: form.duration.value,
          size: form.size.value,
          weight: form.weight.value,
          usage: form.usage.value,
          colors: form.colors.value,
          decoration: form.decoration.value,
          production: form.production.value,
          source: form.source.value,
          people: form.people.value,
          materials: form.materials.value,
          steps: form.steps.value,
          tools: form.tools.value,
          techniques: form.techniques.value,
          innovation: form.innovation.value,
        });

        message.innerHTML = "âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!";
        message.style.color = "green";
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„:", error);
        message.innerHTML = "âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.";
        message.style.color = "red";
      }
    });

    loadProduct();
  </script>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
    .container { background:#fff; padding:20px; border-radius:15px; box-shadow:0 0 10px rgba(0,0,0,.1); max-width:700px; margin:auto; }
    h1 { text-align:center; color:#3a3b57; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input, textarea, select { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:8px; }
    button { margin-top:15px; padding:10px 15px; background:#3498db; color:white; border:none; border-radius:8px; cursor:pointer; }
    button:hover { background:#2980b9; }
    #message { text-align:center; margin-top:15px; font-weight:bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h1>
    <form id="editForm">
      <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
      <input type="text" name="image">

      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
      <input type="text" name="name">

      <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</label>
      <input type="text" name="type">

      <label>Ø§Ù„Ø³Ø¹Ø±</label>
      <input type="text" name="price">

      <label>Ù…Ø¯Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</label>
      <input type="text" name="duration">

      <label>Ø§Ù„Ø­Ø¬Ù…</label>
      <input type="text" name="size">

      <label>Ø§Ù„ÙˆØ²Ù†</label>
      <input type="text" name="weight">

      <label>Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„</label>
      <input type="text" name="usage">

      <label>Ø§Ù„Ø£Ù„ÙˆØ§Ù†</label>
      <input type="text" name="colors">

      <label>Ù†ÙˆØ¹ Ø§Ù„ØªØ²ÙŠÙŠÙ† ÙˆØ§Ù„Ø±Ù…ÙˆØ²</label>
      <input type="text" name="decoration">

      <label>Ø§Ù„Ø¥Ù†ØªØ§Ø¬</label>
      <input type="text" name="production">

      <label>Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø§Ø¯Ø©</label>
      <input type="text" name="source">

      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø®Ù„ÙŠÙ†</label>
      <input type="text" name="people">

      <label>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</label>
      <textarea name="materials"></textarea>

      <label>Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</label>
      <textarea name="steps"></textarea>

      <label>Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø©</label>
      <input type="text" name="tools">

      <label>Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø©</label>
      <input type="text" name="techniques">

      <label>Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø¨ØªÙƒØ±Ø©</label>
      <input type="text" name="innovation">

      <button type="submit">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    </form>
    <div id="message"></div>
  </div>
</body>
</html>
