<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>📋 قائمة المنتجات</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
    table { width:100%; border-collapse:collapse; background:#fff; }
    th, td { border:1px solid #ddd; padding:10px; text-align:center; }
    th { background:#3a3b57; color:#fff; }
    tr:hover { background:#f1f1f1; }
    .loading { text-align:center; font-size:18px; }
    a, button { margin:3px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
    .btn-edit { background:#4CAF50; color:#fff; }
    .btn-delete { background:#E53935; color:#fff; }
    .btn-view { background:#3a3b57; color:#fff; }
  </style>
</head>
<body>
  <h2>📋 قائمة المنتجات</h2>
  <div id="loading" class="loading">⏳ جارٍ تحميل البيانات...</div>
  <table id="productsTable" style="display:none;">
    <thead>
      <tr>
        <th>اسم المنتج</th>
        <th>المعرف (ID)</th>
        <th>الرابط</th>
        <th>الإجراءات</th>
      </tr>
    </thead>
    <tbody id="productsList"></tbody>
  </table>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDq-S2CBiNmccar_neNVg5T95XbwV6t0cY",
      authDomain: "artisanat-161f3.firebaseapp.com",
      projectId: "artisanat-161f3",
      storageBucket: "artisanat-161f3.appspot.com",
      messagingSenderId: "203989144161",
      appId: "1:203989144161:web:88273bf2b917ddc0a65020",
      measurementId: "G-9350J62Z5H"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const table = document.getElementById("productsTable");
    const list = document.getElementById("productsList");
    const loading = document.getElementById("loading");

    async function loadProducts() {
      try {
        const querySnapshot = await getDocs(collection(db, "products"));
        loading.style.display = "none";
        table.style.display = "table";

        querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const row = document.createElement("tr");

          row.innerHTML = `
            <td>${data.name || "-"}</td>
            <td>${data.id}</td>
            <td><a href="edit.html?id=${data.id}" target="_blank">🔗 الرابط</a></td>
            <td>
              <a class="btn-view" href="view.html?id=${data.id}" target="_blank">👁 عرض</a>
              <a class="btn-edit" href="edit.html?id=${data.id}" target="_blank">✏ تعديل</a>
              <button class="btn-delete" data-id="${data.id}">🗑 حذف</button>
            </td>
          `;
          list.appendChild(row);
        });

        // تفعيل الحذف
        document.querySelectorAll(".btn-delete").forEach(btn => {
          btn.addEventListener("click", async (e) => {
            const id = e.target.getAttribute("data-id");
            if (confirm("هل أنت متأكد من الحذف؟")) {
              await deleteDoc(doc(db, "products", id));
              location.reload();
            }
          });
        });

      } catch (err) {
        loading.innerText = "❌ فشل تحميل البيانات: " + err.message;
      }
    }

    loadProducts();
  </script>
</body>
</html>
